// TODO: Add mailing list options
// https://apidocs.mailchimp.com/api/2.0/lists/subscribe.php
// http://stackoverflow.com/questions/19671676/javascript-mailchimp-api-subscribe

Percolate = typeof Percolate === 'undefined' ? {} : Percolate;
Percolate.Contact = {};

Percolate.Contact.Overlay = React.createClass({displayName: "Overlay",
  propTypes: {
    containerElement: React.PropTypes.instanceOf(Element)
  },

  getDefaultProps: function() {
    return {
      containerElement: null
    }
  },

  setOpen: function(open) {
    jQuery(this.props.containerElement).toggleClass('contact-open', !! open);
  },

  handleClose: function(event) {
    event.preventDefault();
    this.setOpen(false);
  },

  render: function() {
    return (
      React.createElement("div", {className: "percolate-contact-overlay"}, 
        React.createElement("a", {className: "overlay-close", onClick: this.handleClose}, 
          React.createElement("span", {className: "icon-cross"})
        ), 
        React.createElement(Percolate.Contact.Form, {setOverlayOpen: this.setOpen})
      )
    )
  }
});

Percolate.Contact.Footer = React.createClass({displayName: "Footer",
  render: function() {
    return (
      React.createElement("div", {className: "ancillary-contact vcard"}, 
        React.createElement("div", {className: "wrapper-connect"}, 
          React.createElement("div", {className: "title-ancillary"}, "Connect"), 
          React.createElement("div", {className: "list"}, 
            React.createElement("a", {className: "url monochrome", href: "http://twitter.com/percolatestudio", target: "_blank"}, "Twitter"), 
            React.createElement("a", {className: "url monochrome", href: "http://github.com/percolatestudio", target: "_blank"}, "Github"), 
            React.createElement("a", {className: "email monochrome", href: "mailto:us@percolatestudio.com?subject=Hello%20Percolate"}, "Email")
          )
        ), 
        React.createElement("div", {className: "wrapper-visit"}, 
          React.createElement("div", {className: "title-ancillary"}, "Visit Us"), 
          React.createElement("a", {className: "location-wrapper organization-unit adr", 
            href: "https://www.google.com/maps/place/169+11th+St,+San+Francisco,+CA+94103/@37.77357,-122.415787,17z/data=!3m1!4b1!4m2!3m1!1s0x8085809d83ced185:0xf5e9ad23d5cd5ce5", target: "_blank"}, 
            React.createElement("span", {className: "fn organization-name", style:  {display: 'none'} }, "Percolate Studio"), 
            React.createElement("span", null, "Percolate USA"), React.createElement("br", null), 
            React.createElement("span", {className: "street-address"}, "169 11th Street"), React.createElement("br", null), 
            React.createElement("span", {className: "locality"}, "San Francisco"), ", ", React.createElement("span", {className: "region"}, "CA"), " ", React.createElement("span", {className: "postal-code"}, "94103")
          ), 
          React.createElement("a", {className: "location-wrapper organization-unit adr", 
            href: "https://www.google.com/maps/place/50+Herbert+St,+Northcote+VIC+3070,+Australia/@-37.771764,144.995165,17z/data=!3m1!4b1!4m2!3m1!1s0x6ad6437ca420f13f:0xb6908ada5cdfa379", target: "_blank"}, 
            React.createElement("span", null, "Percolate AUS"), React.createElement("br", null), 
            React.createElement("span", {className: "street-address"}, "50 Herbert Street"), React.createElement("br", null), 
            React.createElement("span", {className: "locality"}, "Melbourne"), ", ", React.createElement("span", {className: "region"}, "VIC"), " ", React.createElement("span", {className: "postal-code"}, "3001")
          )
        )
      )
    )
  }
});

// Gathers all truthy values in obj referenced by keys and returns matching
// keys in an array
var gatherTruthy = function(/* obj, ...keys */) {
  var keys = Array.prototype.slice.call(arguments);
  var result = [];

  obj = keys.shift();

  _.each(keys, function(key) {
    if (obj[key] && result.indexOf(key) === -1)
      result.push(key);
  });

  return result;
}

Percolate.Contact.Form = React.createClass({displayName: "Form",
  mixins: [React.addons.LinkedStateMixin],

  getInitialState: function() {
    return {
      name: '',
      email: '',
      about: '',
      strategy: false,
      design: false,
      engineering: false,
      consulting: false,
      today: false,
      quarter: false,
      year: false,
      '25k': false,
      '50k': false,
      '100k': false,
      notsure: false,
      errors: {},
      submitting: false
    };
  },

  getModel: function() {
    var model = _.pick(this.state, 'name', 'email', 'about');
    model.services = gatherTruthy(this.state, 'strategy', 'design',
      'engineering', 'consulting');
    model.timing = gatherTruthy(this.state, 'today', 'quarter', 'year');
    model.budget = gatherTruthy(this.state, '25k', '50k', '100k', 'notsure');

    return model;
  },

  handleSubmit: function(event) {
    event.preventDefault();

    if (this.validate()) {
      this.send();
    }
  },

  componentDidMount: function() {
    jQuery(this.refs.about.getDOMNode()).autosize();
  },

  alertClass: function(name) {
    return this.state.errors[name] ? 'alert' : '';
  },

  // urgh, wish we had a schema library
  validate: function() {
    var errors = this.state.errors = {},
      valid = true,
      model = this.getModel();

    _.each(['name', 'email', 'about'], function(field) {
      if (! model[field]) {
        errors[field] = 'is required';
        valid = false;
      } else if (model[field].length > 10000) {
        errors[field] = 'is too long';
        valid = false;
      }
    }.bind(this));

    _.each(['services', 'timing'], function(field) {
      if (! model[field].length) {
        errors[field] = 'is required';
        valid = false;
      }
    }.bind(this));

    if (this.shouldHaveBudget() && ! model.budget.length) {
      errors['budget'] = 'is required';
      valid = false;
    }

    this.setState({errors: errors});

    return valid;
  },

  send: function(model) {
    var model = this.getModel();
    var to = 'us@percolatestudio.com';
    var subject = 'Work with us';
    var body = React.renderToStaticMarkup(
      React.createElement(Percolate.Contact.FormEmail, {model: model}));

    var data = {
        'key': '-JqlbKb2ZHU7R5NEkCvnKw', // changeme
        'message': {
          'from_email': model.email,
          'to': [
              {
                'email': to,
                'name': 'Percolate Studio',
                'type': 'to'
              },
              {
                'email': 'zol@percolatestudio.com', // just in case us@ breaks
                'name': 'Zoltan Olah',
                'type': 'to'
              }
            ],
          'autotext': 'true',
          'subject': subject,
          'html': body
        }
      };

    this.setState({ submitting: true });
    jQuery.post('https://mandrillapp.com/api/1.0/messages/send.json', data)
      .done(function() {
        alert('Thank you. We will contact you shortly');
      })
      .fail(function() {
        // fallback incase ajax fails
        window.open('mailto:' + to
          + '?subject=' + subject + ' (mailto)'
          + '&body=' + escape(body)
        );
      })
      .always(function() {
        this.setState({ submitting: false });
        this.props.setOverlayOpen(false);
      }.bind(this));
  },

  error: function(name) {
    if (this.state.errors[name])
      return (React.createElement("span", {className: "error"}, this.state.errors[name]));
  },

  shouldHaveBudget: function() {
    return this.state.strategy || this.state.design || this.state.engineering;
  },

  render: function() {
    var budgetFieldsetClasses = "fieldset-group hidden "
      + (this.shouldHaveBudget() ? 'visible' : '');

    var servicesError = this.error('services');

    var servicesLabel = servicesError ? servicesError :
      (React.createElement("span", {className: "subtext"}, "Select all that apply"));

    return (
      React.createElement("form", {className: "contact-form-wrapper", onSubmit: this.handleSubmit}, 
        React.createElement("div", {className: "title-overlay"}, "Work with us"), 
        React.createElement("fieldset", null, 
          React.createElement("div", {className: "input-symbol left"}, 
            React.createElement("input", {type: "text", name: "name", className: this.alertClass('name'), placeholder: "Name", valueLink: this.linkState('name')}), 
            React.createElement("span", {className: "icon-user"})
          ), 
          React.createElement("div", {className: "input-symbol left"}, 
            React.createElement("input", {type: "email", name: "email", className: this.alertClass('email'), placeholder: "Email Address", valueLink: this.linkState('email')}), 
            React.createElement("span", {className: "icon-email"})
          ), 
          React.createElement("textarea", {className: 'about ' + this.alertClass('about'), name: "about", placeholder: "About your company and project", valueLink: this.linkState('about'), ref: "about"}), 
          React.createElement("div", {className: "fieldset-group services"}, 
            React.createElement("div", {className: "fieldset-group-title"}, "Services ", servicesLabel), 

            React.createElement("div", {className: "btns-group"}, 
              React.createElement("input", {type: "checkbox", name: "services", value: "strategy", id: "strategy", checkedLink: this.linkState('strategy')}), 
              React.createElement("label", {htmlFor: "strategy", className: "btn-toggle"}, "Strategy"), 

              React.createElement("input", {type: "checkbox", name: "services", value: "design", id: "design", checkedLink: this.linkState('design')}), 
              React.createElement("label", {htmlFor: "design", className: "btn-toggle"}, "Design"), 

              React.createElement("input", {type: "checkbox", name: "services", value: "engineering", id: "engineering", checkedLink: this.linkState('engineering')}), 
              React.createElement("label", {htmlFor: "engineering", className: "btn-toggle"}, "Engineering"), 

              React.createElement("input", {type: "checkbox", name: "services", value: "consulting", id: "consulting", checkedLink: this.linkState('consulting')}), 
              React.createElement("label", {htmlFor: "consulting", className: "btn-toggle"}, "Consulting")
            )
          ), 
          React.createElement("div", {className: "fieldset-group"}, 
            React.createElement("div", {className: "fieldset-group-title"}, "Timing ", this.error('timing')), 

            React.createElement("div", {className: "btns-group"}, 
              React.createElement("input", {type: "radio", name: "timing", value: "today", id: "today", checkedLink: this.linkState('today')}), 
              React.createElement("label", {htmlFor: "today", className: "btn-toggle"}, "Today"), 

              React.createElement("input", {type: "radio", name: "timing", value: "quarter", id: "quarter", checkedLink: this.linkState('quarter')}), 
              React.createElement("label", {htmlFor: "quarter", className: "btn-toggle"}, "Quarter"), 

              React.createElement("input", {type: "radio", name: "timing", value: "year", id: "year", checkedLink: this.linkState('year')}), 
              React.createElement("label", {htmlFor: "year", className: "btn-toggle"}, "This Year")
            )
          ), 
          React.createElement("div", {className: budgetFieldsetClasses}, 
            React.createElement("div", {className: "fieldset-group-title"}, "Budget ", this.error('budget')), 

            React.createElement("div", {className: "btns-group"}, 
              React.createElement("input", {type: "radio", name: "budget", value: "25k", id: "25k", checkedLink: this.linkState('25k')}), 
              React.createElement("label", {htmlFor: "25k", className: "btn-toggle"}, "25k–50k"), 

              React.createElement("input", {type: "radio", name: "budget", value: "50k", id: "50k", checkedLink: this.linkState('50k')}), 
              React.createElement("label", {htmlFor: "50k", className: "btn-toggle"}, "50k–100k"), 

              React.createElement("input", {type: "radio", name: "budget", value: "100k", id: "100k", checkedLink: this.linkState('100k')}), 
              React.createElement("label", {htmlFor: "100k", className: "btn-toggle"}, "+100k"), 

              React.createElement("input", {type: "radio", name: "budget", value: "notsure", id: "notsure", checkedLink: this.linkState('notsure')}), 
              React.createElement("label", {htmlFor: "notsure", className: "btn-toggle"}, "Not sure")
            )

          ), 
          React.createElement("button", {className: "btn-primary caps", disabled: this.state.submitting, type: "submit"}, "Send Message")
        ), 
        React.createElement(Percolate.Contact.Footer, null)
      )
    )
  }
});

Percolate.Contact.FormEmail = React.createClass({displayName: "FormEmail",
  render: function() {
    var model = this.props.model;

    var servicesNodes = model.services.map(function(service, index) {
      return ( React.createElement("li", {key: index}, service) );
    });

    var timing = model.timing.join();
    var budget = model.budget.join();

    var budgetNodes = budget ? [React.createElement("dt", {key: "0"}, "Budget"), React.createElement("dd", {key: "1"}, budget)] : null;

    return (
      React.createElement("dl", null, 
        React.createElement("dt", null, "Name"), React.createElement("dd", null, model.name), 
        React.createElement("dt", null, "Email"), React.createElement("dd", null, model.email), 
        React.createElement("dt", null, "About"), React.createElement("dd", null, model.about), 
        React.createElement("dt", null, "Services"), React.createElement("dd", null, React.createElement("ul", null, servicesNodes)), 
        React.createElement("dt", null, "Timing"), React.createElement("dd", null, timing), 
        budgetNodes, 
        React.createElement("dt", null, "Referer"), React.createElement("dd", null, "Blog")
      )
    )
  }
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZWQuanMiLCJzb3VyY2VzIjpbbnVsbF0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlDQUFpQztBQUNqQyw0REFBNEQ7QUFDNUQsaUZBQWlGOztBQUVqRixTQUFTLEdBQUcsT0FBTyxTQUFTLEtBQUssV0FBVyxHQUFHLEVBQUUsR0FBRyxTQUFTLENBQUM7QUFDOUQsU0FBUyxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7O0FBRXZCLCtDQUErQyx1QkFBQTtFQUM3QyxTQUFTLEVBQUU7SUFDVCxnQkFBZ0IsRUFBRSxLQUFLLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUM7QUFDekQsR0FBRzs7RUFFRCxlQUFlLEVBQUUsV0FBVyxDQUFDO0lBQzNCLE9BQU87TUFDTCxnQkFBZ0IsRUFBRSxJQUFJO0tBQ3ZCO0FBQ0wsR0FBRzs7RUFFRCxPQUFPLEVBQUUsU0FBUyxJQUFJLEVBQUUsQ0FBQztJQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzdFLEdBQUc7O0VBRUQsV0FBVyxFQUFFLFNBQVMsS0FBSyxFQUFFLENBQUM7SUFDNUIsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3ZCLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDeEIsR0FBRzs7RUFFRCxNQUFNLEVBQUUsV0FBVyxDQUFDO0lBQ2xCO01BQ0Usb0JBQUEsS0FBSSxFQUFBLENBQUEsQ0FBQyxTQUFBLEVBQVMsQ0FBQywyQkFBNEIsQ0FBQSxFQUFBO1FBQ3pDLG9CQUFBLEdBQUUsRUFBQSxDQUFBLENBQUMsU0FBQSxFQUFTLENBQUMsZUFBQSxFQUFlLENBQUMsT0FBQSxFQUFPLENBQUUsSUFBSSxDQUFDLFdBQWEsQ0FBQSxFQUFBO1VBQ3RELG9CQUFBLE1BQUssRUFBQSxDQUFBLENBQUMsU0FBQSxFQUFTLENBQUMs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QUV6RSxvQkFBQSxLQUFJLEVBQUEsQ0FBQSxDQUFDLFNBQUEsRUFBUyxDQUFDLFlBQWEsQ0FBQSxFQUFBO2NBQzFCLG9CQUFBLE9BQU0sRUFBQSxDQUFBLENBQUMsSUFBQSxFQUFJLENBQUMsT0FBQSxFQUFPLENBQUMsSUFBQSxFQUFJLENBQUMsUUFBQSxFQUFRLENBQUMsS0FBQSxFQUFLLENBQUMsT0FBQSxFQUFPLENBQUMsRUFBQSxFQUFFLENBQUMsT0FBQSxFQUFPLENBQUMsV0FBQSxFQUFXLENBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUUsQ0FBQSxDQUFHLENBQUEsRUFBQTtBQUNqSCxjQUFjLG9CQUFBLE9BQU0sRUFBQSxDQUFBLENBQUMsT0FBQSxFQUFPLENBQUMsT0FBQSxFQUFPLENBQUMsU0FBQSxFQUFTLENBQUMsWUFBYSxDQUFBLEVBQUEsT0FBYSxDQUFBLEVBQUE7O2NBRTNELG9CQUFBLE9BQU0sRUFBQSxDQUFBLENBQUMsSUFBQSxFQUFJLENBQUMsT0FBQSxFQUFPLENBQUMsSUFBQSxFQUFJLENBQUMsUUFBQSxFQUFRLENBQUMsS0FBQSxFQUFLLENBQUMsU0FBQSxFQUFTLENBQUMsRUFBQSxFQUFFLENBQUMsU0FBQSxFQUFTLENBQUMsV0FBQSxFQUFXLENBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUUsQ0FBQSxDQUFHLENBQUEsRUFBQTtBQUN2SCxjQUFjLG9CQUFBLE9BQU0sRUFBQSxDQUFBLENBQUMsT0FBQSxFQUFPLENBQUMsU0FBQSxFQUFTLENBQUMsU0FBQSxFQUFTLENBQUMsWUFBYSxDQUFBLEVBQUEsU0FBZSxDQUFBLEVBQUE7O2NBRS9ELG9CQUFBLE9BQU0sRUFBQSxDQUFBLENBQUMsSUFBQSxFQUFJLENBQUMsT0FBQSxFQUFPLENBQUMsSUFBQSxFQUFJLENBQUMsUUFBQSxFQUFRLENBQUMsS0FBQSxFQUFLLENBQUMsTUFBQSxFQUFNLENBQUMsRUFBQSxFQUFFLENBQUMsTUFBQSxFQUFNLENBQUMsV0FBQSxFQUFXLENBQUUsSUFBSSxDQUFDLFNB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QSxJQUFHLEVBQUEsSUFBQyxFQUFDLEtBQUssQ0FBQyxJQUFVLENBQUEsRUFBQTtRQUNsQyxvQkFBQSxJQUFHLEVBQUEsSUFBQyxFQUFBLE9BQVUsQ0FBQSxFQUFBLG9CQUFBLElBQUcsRUFBQSxJQUFDLEVBQUMsS0FBSyxDQUFDLEtBQVcsQ0FBQSxFQUFBO1FBQ3BDLG9CQUFBLElBQUcsRUFBQSxJQUFDLEVBQUEsT0FBVSxDQUFBLEVBQUEsb0JBQUEsSUFBRyxFQUFBLElBQUMsRUFBQyxLQUFLLENBQUMsS0FBVyxDQUFBLEVBQUE7UUFDcEMsb0JBQUEsSUFBRyxFQUFBLElBQUMsRUFBQSxVQUFhLENBQUEsRUFBQSxvQkFBQSxJQUFHLEVBQUEsSUFBQyxFQUFBLG9CQUFBLElBQUcsRUFBQSxJQUFDLEVBQUMsYUFBbUIsQ0FBSyxDQUFBLEVBQUE7UUFDbEQsb0JBQUEsSUFBRyxFQUFBLElBQUMsRUFBQSxRQUFXLENBQUEsRUFBQSxvQkFBQSxJQUFHLEVBQUEsSUFBQyxFQUFDLE1BQVksQ0FBQSxFQUFBO1FBQy9CLFdBQVcsRUFBQztRQUNiLG9CQUFBLElBQUcsRUFBQSxJQUFDLEVBQUEsU0FBWSxDQUFBLEVBQUEsb0JBQUEsSUFBRyxFQUFBLElBQUMsRUFBQSxNQUFTLENBQUE7TUFDMUIsQ0FBQTtLQUNOO0dBQ0Y7Q0FDRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUT0RPOiBBZGQgbWFpbGluZyBsaXN0IG9wdGlvbnNcbi8vIGh0dHBzOi8vYXBpZG9jcy5tYWlsY2hpbXAuY29tL2FwaS8yLjAvbGlzdHMvc3Vic2NyaWJlLnBocFxuLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xOTY3MTY3Ni9qYXZhc2NyaXB0LW1haWxjaGltcC1hcGktc3Vic2NyaWJlXG5cblBlcmNvbGF0ZSA9IHR5cGVvZiBQZXJjb2xhdGUgPT09ICd1bmRlZmluZWQnID8ge30gOiBQZXJjb2xhdGU7XG5QZXJjb2xhdGUuQ29udGFjdCA9IHt9O1xuXG5QZXJjb2xhdGUuQ29udGFjdC5PdmVybGF5ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICBwcm9wVHlwZXM6IHtcbiAgICBjb250YWluZXJFbGVtZW50OiBSZWFjdC5Qcm9wVHlwZXMuaW5zdGFuY2VPZihFbGVtZW50KVxuICB9LFxuXG4gIGdldERlZmF1bHRQcm9wczogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbnRhaW5lckVsZW1lbnQ6IG51bGxcbiAgICB9XG4gIH0sXG5cbiAgc2V0T3BlbjogZnVuY3Rpb24ob3Blbikge1xuICAgIGpRdWVyeSh0aGlzLnByb3BzLmNvbnRhaW5lckVsZW1lbnQpLnRvZ2dsZUNsYXNzKCdjb250YWN0LW9wZW4nLCAhISBvcGVuKTtcbiAgfSxcblxuICBoYW5kbGVDbG9zZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuc2V0T3BlbihmYWxzZSk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9J3BlcmNvbGF0ZS1jb250YWN0LW92ZXJsYXknPlxuICAgICAgICA8YSBjbGFzc05hbWU9XCJvdmVybGF5LWNsb3NlXCIgb25DbGljaz17dGhpcy5oYW5kbGVDbG9zZX0+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiaWNvbi1jcm9zc1wiPjwvc3Bhbj5cbiAgICAgICAgPC9hPlxuICAgICAgICA8UGVyY29sYXRlLkNvbnRhY3QuRm9ybSBzZXRPdmVybGF5T3Blbj17dGhpcy5zZXRPcGVufSAvPlxuICAgICAgPC9kaXY+XG4gICAgKVxuICB9XG59KTtcblxuUGVyY29sYXRlLkNvbnRhY3QuRm9vdGVyID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImFuY2lsbGFyeS1jb250YWN0IHZjYXJkXCI+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwid3JhcHBlci1jb25uZWN0XCI+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0aXRsZS1hbmNpbGxhcnlcIj5Db25uZWN0PC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsaXN0XCI+XG4gICAgICAgICAgICA8YSBjbGFzc05hbWU9XCJ1cmwgbW9ub2Nocm9tZVwiIGhyZWY9XCJodHRwOi8vdHdpdHRlci5jb20vcGVyY29sYXRlc3R1ZGlvXCIgdGFyZ2V0PVwiX2JsYW5rXCI+VHdpdHRlcjwvYT5cbiAgICAgICAgICAgIDxhIGNsYXNzTmFtZT1cInVybCBtb25vY2hyb21lXCIgaHJlZj1cImh0dHA6Ly9naXRodWIuY29tL3BlcmNvbGF0ZXN0dWRpb1wiIHRhcmdldD1cIl9ibGFua1wiPkdpdGh1YjwvYT5cbiAgICAgICAgICAgIDxhIGNsYXNzTmFtZT1cImVtYWlsIG1vbm9jaHJvbWVcIiBocmVmPVwibWFpbHRvOnVzQHBlcmNvbGF0ZXN0dWRpby5jb20/c3ViamVjdD1IZWxsbyUyMFBlcmNvbGF0ZVwiPkVtYWlsPC9hPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ3cmFwcGVyLXZpc2l0XCI+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0aXRsZS1hbmNpbGxhcnlcIj5WaXNpdCBVczwvZGl2PlxuICAgICAgICAgIDxhIGNsYXNzTmFtZT1cImxvY2F0aW9uLXdyYXBwZXIgb3JnYW5pemF0aW9uLXVuaXQgYWRyXCJcbiAgICAgICAgICAgIGhyZWY9XCJodHRwczovL3d3dy5nb29nbGUuY29tL21hcHMvcGxhY2UvMTY5KzExdGgrU3QsK1NhbitGcmFuY2lzY28sK0NBKzk0MTAzL0AzNy43NzM1NywtMTIyLjQxNTc4NywxN3ovZGF0YT0hM20xITRiMSE0bTIhM20xITFzMHg4MDg1ODA5ZDgzY2VkMTg1OjB4ZjVlOWFkMjNkNWNkNWNlNVwiIHRhcmdldD1cIl9ibGFua1wiPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZm4gb3JnYW5pemF0aW9uLW5hbWVcIiBzdHlsZT17IHtkaXNwbGF5OiAnbm9uZSd9IH0+UGVyY29sYXRlIFN0dWRpbzwvc3Bhbj5cbiAgICAgICAgICAgIDxzcGFuPlBlcmNvbGF0ZSBVU0E8L3NwYW4+PGJyLz5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cInN0cmVldC1hZGRyZXNzXCI+MTY5IDExdGggU3RyZWV0PC9zcGFuPjxici8+XG4gICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJsb2NhbGl0eVwiPlNhbiBGcmFuY2lzY288L3NwYW4+LCA8c3BhbiBjbGFzc05hbWU9XCJyZWdpb25cIj5DQTwvc3Bhbj4gPHNwYW4gY2xhc3NOYW1lPVwicG9zdGFsLWNvZGVcIj45NDEwMzwvc3Bhbj5cbiAgICAgICAgICA8L2E+XG4gICAgICAgICAgPGEgY2xhc3NOYW1lPVwibG9jYXRpb24td3JhcHBlciBvcmdhbml6YXRpb24tdW5pdCBhZHJcIlxuICAgICAgICAgICAgaHJlZj1cImh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vbWFwcy9wbGFjZS81MCtIZXJiZXJ0K1N0LCtOb3J0aGNvdGUrVklDKzMwNzAsK0F1c3RyYWxpYS9ALTM3Ljc3MTc2NCwxNDQuOTk1MTY1LDE3ei9kYXRhPSEzbTEhNGIxITRtMiEzbTEhMXMweDZhZDY0MzdjYTQyMGYxM2Y6MHhiNjkwOGFkYTVjZGZhMzc5XCIgIHRhcmdldD1cIl9ibGFua1wiPlxuICAgICAgICAgICAgPHNwYW4+UGVyY29sYXRlIEFVUzwvc3Bhbj48YnIvPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwic3RyZWV0LWFkZHJlc3NcIj41MCBIZXJiZXJ0IFN0cmVldDwvc3Bhbj48YnIvPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibG9jYWxpdHlcIj5NZWxib3VybmU8L3NwYW4+LCA8c3BhbiBjbGFzc05hbWU9XCJyZWdpb25cIj5WSUM8L3NwYW4+IDxzcGFuIGNsYXNzTmFtZT1cInBvc3RhbC1jb2RlXCI+MzAwMTwvc3Bhbj5cbiAgICAgICAgICA8L2E+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKVxuICB9XG59KTtcblxuLy8gR2F0aGVycyBhbGwgdHJ1dGh5IHZhbHVlcyBpbiBvYmogcmVmZXJlbmNlZCBieSBrZXlzIGFuZCByZXR1cm5zIG1hdGNoaW5nXG4vLyBrZXlzIGluIGFuIGFycmF5XG52YXIgZ2F0aGVyVHJ1dGh5ID0gZnVuY3Rpb24oLyogb2JqLCAuLi5rZXlzICovKSB7XG4gIHZhciBrZXlzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgdmFyIHJlc3VsdCA9IFtdO1xuXG4gIG9iaiA9IGtleXMuc2hpZnQoKTtcblxuICBfLmVhY2goa2V5cywgZnVuY3Rpb24oa2V5KSB7XG4gICAgaWYgKG9ialtrZXldICYmIHJlc3VsdC5pbmRleE9mKGtleSkgPT09IC0xKVxuICAgICAgcmVzdWx0LnB1c2goa2V5KTtcbiAgfSk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuUGVyY29sYXRlLkNvbnRhY3QuRm9ybSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgbWl4aW5zOiBbUmVhY3QuYWRkb25zLkxpbmtlZFN0YXRlTWl4aW5dLFxuXG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6ICcnLFxuICAgICAgZW1haWw6ICcnLFxuICAgICAgYWJvdXQ6ICcnLFxuICAgICAgc3RyYXRlZ3k6IGZhbHNlLFxuICAgICAgZGVzaWduOiBmYWxzZSxcbiAgICAgIGVuZ2luZWVyaW5nOiBmYWxzZSxcbiAgICAgIGNvbnN1bHRpbmc6IGZhbHNlLFxuICAgICAgdG9kYXk6IGZhbHNlLFxuICAgICAgcXVhcnRlcjogZmFsc2UsXG4gICAgICB5ZWFyOiBmYWxzZSxcbiAgICAgICcyNWsnOiBmYWxzZSxcbiAgICAgICc1MGsnOiBmYWxzZSxcbiAgICAgICcxMDBrJzogZmFsc2UsXG4gICAgICBub3RzdXJlOiBmYWxzZSxcbiAgICAgIGVycm9yczoge30sXG4gICAgICBzdWJtaXR0aW5nOiBmYWxzZVxuICAgIH07XG4gIH0sXG5cbiAgZ2V0TW9kZWw6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtb2RlbCA9IF8ucGljayh0aGlzLnN0YXRlLCAnbmFtZScsICdlbWFpbCcsICdhYm91dCcpO1xuICAgIG1vZGVsLnNlcnZpY2VzID0gZ2F0aGVyVHJ1dGh5KHRoaXMuc3RhdGUsICdzdHJhdGVneScsICdkZXNpZ24nLFxuICAgICAgJ2VuZ2luZWVyaW5nJywgJ2NvbnN1bHRpbmcnKTtcbiAgICBtb2RlbC50aW1pbmcgPSBnYXRoZXJUcnV0aHkodGhpcy5zdGF0ZSwgJ3RvZGF5JywgJ3F1YXJ0ZXInLCAneWVhcicpO1xuICAgIG1vZGVsLmJ1ZGdldCA9IGdhdGhlclRydXRoeSh0aGlzLnN0YXRlLCAnMjVrJywgJzUwaycsICcxMDBrJywgJ25vdHN1cmUnKTtcblxuICAgIHJldHVybiBtb2RlbDtcbiAgfSxcblxuICBoYW5kbGVTdWJtaXQ6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIGlmICh0aGlzLnZhbGlkYXRlKCkpIHtcbiAgICAgIHRoaXMuc2VuZCgpO1xuICAgIH1cbiAgfSxcblxuICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XG4gICAgalF1ZXJ5KHRoaXMucmVmcy5hYm91dC5nZXRET01Ob2RlKCkpLmF1dG9zaXplKCk7XG4gIH0sXG5cbiAgYWxlcnRDbGFzczogZnVuY3Rpb24obmFtZSkge1xuICAgIHJldHVybiB0aGlzLnN0YXRlLmVycm9yc1tuYW1lXSA/ICdhbGVydCcgOiAnJztcbiAgfSxcblxuICAvLyB1cmdoLCB3aXNoIHdlIGhhZCBhIHNjaGVtYSBsaWJyYXJ5XG4gIHZhbGlkYXRlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgZXJyb3JzID0gdGhpcy5zdGF0ZS5lcnJvcnMgPSB7fSxcbiAgICAgIHZhbGlkID0gdHJ1ZSxcbiAgICAgIG1vZGVsID0gdGhpcy5nZXRNb2RlbCgpO1xuXG4gICAgXy5lYWNoKFsnbmFtZScsICdlbWFpbCcsICdhYm91dCddLCBmdW5jdGlvbihmaWVsZCkge1xuICAgICAgaWYgKCEgbW9kZWxbZmllbGRdKSB7XG4gICAgICAgIGVycm9yc1tmaWVsZF0gPSAnaXMgcmVxdWlyZWQnO1xuICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgfSBlbHNlIGlmIChtb2RlbFtmaWVsZF0ubGVuZ3RoID4gMTAwMDApIHtcbiAgICAgICAgZXJyb3JzW2ZpZWxkXSA9ICdpcyB0b28gbG9uZyc7XG4gICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIF8uZWFjaChbJ3NlcnZpY2VzJywgJ3RpbWluZyddLCBmdW5jdGlvbihmaWVsZCkge1xuICAgICAgaWYgKCEgbW9kZWxbZmllbGRdLmxlbmd0aCkge1xuICAgICAgICBlcnJvcnNbZmllbGRdID0gJ2lzIHJlcXVpcmVkJztcbiAgICAgICAgdmFsaWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgaWYgKHRoaXMuc2hvdWxkSGF2ZUJ1ZGdldCgpICYmICEgbW9kZWwuYnVkZ2V0Lmxlbmd0aCkge1xuICAgICAgZXJyb3JzWydidWRnZXQnXSA9ICdpcyByZXF1aXJlZCc7XG4gICAgICB2YWxpZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMuc2V0U3RhdGUoe2Vycm9yczogZXJyb3JzfSk7XG5cbiAgICByZXR1cm4gdmFsaWQ7XG4gIH0sXG5cbiAgc2VuZDogZnVuY3Rpb24obW9kZWwpIHtcbiAgICB2YXIgbW9kZWwgPSB0aGlzLmdldE1vZGVsKCk7XG4gICAgdmFyIHRvID0gJ3VzQHBlcmNvbGF0ZXN0dWRpby5jb20nO1xuICAgIHZhciBzdWJqZWN0ID0gJ1dvcmsgd2l0aCB1cyc7XG4gICAgdmFyIGJvZHkgPSBSZWFjdC5yZW5kZXJUb1N0YXRpY01hcmt1cChcbiAgICAgIDxQZXJjb2xhdGUuQ29udGFjdC5Gb3JtRW1haWwgbW9kZWw9e21vZGVsfS8+KTtcblxuICAgIHZhciBkYXRhID0ge1xuICAgICAgICAna2V5JzogJy1KcWxiS2IyWkhVN1I1TkVrQ3ZuS3cnLCAvLyBjaGFuZ2VtZVxuICAgICAgICAnbWVzc2FnZSc6IHtcbiAgICAgICAgICAnZnJvbV9lbWFpbCc6IG1vZGVsLmVtYWlsLFxuICAgICAgICAgICd0byc6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICdlbWFpbCc6IHRvLFxuICAgICAgICAgICAgICAgICduYW1lJzogJ1BlcmNvbGF0ZSBTdHVkaW8nLFxuICAgICAgICAgICAgICAgICd0eXBlJzogJ3RvJ1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJ2VtYWlsJzogJ3pvbEBwZXJjb2xhdGVzdHVkaW8uY29tJywgLy8ganVzdCBpbiBjYXNlIHVzQCBicmVha3NcbiAgICAgICAgICAgICAgICAnbmFtZSc6ICdab2x0YW4gT2xhaCcsXG4gICAgICAgICAgICAgICAgJ3R5cGUnOiAndG8nXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgJ2F1dG90ZXh0JzogJ3RydWUnLFxuICAgICAgICAgICdzdWJqZWN0Jzogc3ViamVjdCxcbiAgICAgICAgICAnaHRtbCc6IGJvZHlcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgIHRoaXMuc2V0U3RhdGUoeyBzdWJtaXR0aW5nOiB0cnVlIH0pO1xuICAgIGpRdWVyeS5wb3N0KCdodHRwczovL21hbmRyaWxsYXBwLmNvbS9hcGkvMS4wL21lc3NhZ2VzL3NlbmQuanNvbicsIGRhdGEpXG4gICAgICAuZG9uZShmdW5jdGlvbigpIHtcbiAgICAgICAgYWxlcnQoJ1RoYW5rIHlvdS4gV2Ugd2lsbCBjb250YWN0IHlvdSBzaG9ydGx5Jyk7XG4gICAgICB9KVxuICAgICAgLmZhaWwoZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGZhbGxiYWNrIGluY2FzZSBhamF4IGZhaWxzXG4gICAgICAgIHdpbmRvdy5vcGVuKCdtYWlsdG86JyArIHRvXG4gICAgICAgICAgKyAnP3N1YmplY3Q9JyArIHN1YmplY3QgKyAnIChtYWlsdG8pJ1xuICAgICAgICAgICsgJyZib2R5PScgKyBlc2NhcGUoYm9keSlcbiAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgICAuYWx3YXlzKGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc3VibWl0dGluZzogZmFsc2UgfSk7XG4gICAgICAgIHRoaXMucHJvcHMuc2V0T3ZlcmxheU9wZW4oZmFsc2UpO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgfSxcblxuICBlcnJvcjogZnVuY3Rpb24obmFtZSkge1xuICAgIGlmICh0aGlzLnN0YXRlLmVycm9yc1tuYW1lXSlcbiAgICAgIHJldHVybiAoPHNwYW4gY2xhc3NOYW1lPVwiZXJyb3JcIj57dGhpcy5zdGF0ZS5lcnJvcnNbbmFtZV19PC9zcGFuPik7XG4gIH0sXG5cbiAgc2hvdWxkSGF2ZUJ1ZGdldDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUuc3RyYXRlZ3kgfHwgdGhpcy5zdGF0ZS5kZXNpZ24gfHwgdGhpcy5zdGF0ZS5lbmdpbmVlcmluZztcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBidWRnZXRGaWVsZHNldENsYXNzZXMgPSBcImZpZWxkc2V0LWdyb3VwIGhpZGRlbiBcIlxuICAgICAgKyAodGhpcy5zaG91bGRIYXZlQnVkZ2V0KCkgPyAndmlzaWJsZScgOiAnJyk7XG5cbiAgICB2YXIgc2VydmljZXNFcnJvciA9IHRoaXMuZXJyb3IoJ3NlcnZpY2VzJyk7XG5cbiAgICB2YXIgc2VydmljZXNMYWJlbCA9IHNlcnZpY2VzRXJyb3IgPyBzZXJ2aWNlc0Vycm9yIDpcbiAgICAgICg8c3BhbiBjbGFzc05hbWU9XCJzdWJ0ZXh0XCI+U2VsZWN0IGFsbCB0aGF0IGFwcGx5PC9zcGFuPik7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGZvcm0gY2xhc3NOYW1lPVwiY29udGFjdC1mb3JtLXdyYXBwZXJcIiBvblN1Ym1pdD17dGhpcy5oYW5kbGVTdWJtaXR9PlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInRpdGxlLW92ZXJsYXlcIj5Xb3JrIHdpdGggdXM8L2Rpdj5cbiAgICAgICAgPGZpZWxkc2V0PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaW5wdXQtc3ltYm9sIGxlZnRcIj5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIG5hbWU9XCJuYW1lXCIgY2xhc3NOYW1lPXt0aGlzLmFsZXJ0Q2xhc3MoJ25hbWUnKX0gcGxhY2Vob2xkZXI9XCJOYW1lXCIgdmFsdWVMaW5rPXt0aGlzLmxpbmtTdGF0ZSgnbmFtZScpfSAvPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiaWNvbi11c2VyXCI+PC9zcGFuPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaW5wdXQtc3ltYm9sIGxlZnRcIj5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiZW1haWxcIiBuYW1lPVwiZW1haWxcIiBjbGFzc05hbWU9e3RoaXMuYWxlcnRDbGFzcygnZW1haWwnKX0gcGxhY2Vob2xkZXI9XCJFbWFpbCBBZGRyZXNzXCIgdmFsdWVMaW5rPXt0aGlzLmxpbmtTdGF0ZSgnZW1haWwnKX0gLz5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImljb24tZW1haWxcIj48L3NwYW4+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPHRleHRhcmVhIGNsYXNzTmFtZT17J2Fib3V0ICcgKyB0aGlzLmFsZXJ0Q2xhc3MoJ2Fib3V0Jyl9IG5hbWU9XCJhYm91dFwiIHBsYWNlaG9sZGVyPVwiQWJvdXQgeW91ciBjb21wYW55IGFuZCBwcm9qZWN0XCIgdmFsdWVMaW5rPXt0aGlzLmxpbmtTdGF0ZSgnYWJvdXQnKX0gcmVmPVwiYWJvdXRcIiAvPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmllbGRzZXQtZ3JvdXAgc2VydmljZXNcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmllbGRzZXQtZ3JvdXAtdGl0bGVcIj5TZXJ2aWNlcyB7c2VydmljZXNMYWJlbH08L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJidG5zLWdyb3VwXCI+XG4gICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBuYW1lPVwic2VydmljZXNcIiB2YWx1ZT1cInN0cmF0ZWd5XCIgaWQ9XCJzdHJhdGVneVwiIGNoZWNrZWRMaW5rPXt0aGlzLmxpbmtTdGF0ZSgnc3RyYXRlZ3knKX0gLz5cbiAgICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJzdHJhdGVneVwiIGNsYXNzTmFtZT1cImJ0bi10b2dnbGVcIj5TdHJhdGVneTwvbGFiZWw+XG5cbiAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIG5hbWU9XCJzZXJ2aWNlc1wiIHZhbHVlPVwiZGVzaWduXCIgaWQ9XCJkZXNpZ25cIiBjaGVja2VkTGluaz17dGhpcy5saW5rU3RhdGUoJ2Rlc2lnbicpfSAvPlxuICAgICAgICAgICAgICA8bGFiZWwgaHRtbEZvcj1cImRlc2lnblwiIGNsYXNzTmFtZT1cImJ0bi10b2dnbGVcIj5EZXNpZ248L2xhYmVsPlxuXG4gICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBuYW1lPVwic2VydmljZXNcIiB2YWx1ZT1cImVuZ2luZWVyaW5nXCIgaWQ9XCJlbmdpbmVlcmluZ1wiIGNoZWNrZWRMaW5rPXt0aGlzLmxpbmtTdGF0ZSgnZW5naW5lZXJpbmcnKX0gLz5cbiAgICAgICAgICAgICAgPGxhYmVsIGh0bWxGb3I9XCJlbmdpbmVlcmluZ1wiIGNsYXNzTmFtZT1cImJ0bi10b2dnbGVcIj5FbmdpbmVlcmluZzwvbGFiZWw+XG5cbiAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIG5hbWU9XCJzZXJ2aWNlc1wiIHZhbHVlPVwiY29uc3VsdGluZ1wiIGlkPVwiY29uc3VsdGluZ1wiIGNoZWNrZWRMaW5rPXt0aGlzLmxpbmtTdGF0ZSgnY29uc3VsdGluZycpfSAvPlxuICAgICAgICAgICAgICA8bGFiZWwgaHRtbEZvcj1cImNvbnN1bHRpbmdcIiBjbGFzc05hbWU9XCJidG4tdG9nZ2xlXCI+Q29uc3VsdGluZzwvbGFiZWw+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZpZWxkc2V0LWdyb3VwXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZpZWxkc2V0LWdyb3VwLXRpdGxlXCI+VGltaW5nIHt0aGlzLmVycm9yKCd0aW1pbmcnKX08L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJidG5zLWdyb3VwXCI+XG4gICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwicmFkaW9cIiBuYW1lPVwidGltaW5nXCIgdmFsdWU9XCJ0b2RheVwiIGlkPVwidG9kYXlcIiBjaGVja2VkTGluaz17dGhpcy5saW5rU3RhdGUoJ3RvZGF5Jyl9IC8+XG4gICAgICAgICAgICAgIDxsYWJlbCBodG1sRm9yPVwidG9kYXlcIiBjbGFzc05hbWU9XCJidG4tdG9nZ2xlXCI+VG9kYXk8L2xhYmVsPlxuXG4gICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwicmFkaW9cIiBuYW1lPVwidGltaW5nXCIgdmFsdWU9XCJxdWFydGVyXCIgaWQ9XCJxdWFydGVyXCIgY2hlY2tlZExpbms9e3RoaXMubGlua1N0YXRlKCdxdWFydGVyJyl9IC8+XG4gICAgICAgICAgICAgIDxsYWJlbCBodG1sRm9yPVwicXVhcnRlclwiIGNsYXNzTmFtZT1cImJ0bi10b2dnbGVcIj5RdWFydGVyPC9sYWJlbD5cblxuICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInRpbWluZ1wiIHZhbHVlPVwieWVhclwiIGlkPVwieWVhclwiIGNoZWNrZWRMaW5rPXt0aGlzLmxpbmtTdGF0ZSgneWVhcicpfSAvPlxuICAgICAgICAgICAgICA8bGFiZWwgaHRtbEZvcj1cInllYXJcIiBjbGFzc05hbWU9XCJidG4tdG9nZ2xlXCI+VGhpcyBZZWFyPC9sYWJlbD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtidWRnZXRGaWVsZHNldENsYXNzZXN9PlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmaWVsZHNldC1ncm91cC10aXRsZVwiPkJ1ZGdldCB7dGhpcy5lcnJvcignYnVkZ2V0Jyl9PC9kaXY+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYnRucy1ncm91cFwiPlxuICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cImJ1ZGdldFwiIHZhbHVlPVwiMjVrXCIgaWQ9XCIyNWtcIiBjaGVja2VkTGluaz17dGhpcy5saW5rU3RhdGUoJzI1aycpfSAvPlxuICAgICAgICAgICAgICA8bGFiZWwgaHRtbEZvcj1cIjI1a1wiIGNsYXNzTmFtZT1cImJ0bi10b2dnbGVcIj4yNWvigJM1MGs8L2xhYmVsPlxuXG4gICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwicmFkaW9cIiBuYW1lPVwiYnVkZ2V0XCIgdmFsdWU9XCI1MGtcIiBpZD1cIjUwa1wiIGNoZWNrZWRMaW5rPXt0aGlzLmxpbmtTdGF0ZSgnNTBrJyl9IC8+XG4gICAgICAgICAgICAgIDxsYWJlbCBodG1sRm9yPVwiNTBrXCIgIGNsYXNzTmFtZT1cImJ0bi10b2dnbGVcIj41MGvigJMxMDBrPC9sYWJlbD5cblxuICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cImJ1ZGdldFwiIHZhbHVlPVwiMTAwa1wiIGlkPVwiMTAwa1wiIGNoZWNrZWRMaW5rPXt0aGlzLmxpbmtTdGF0ZSgnMTAwaycpfSAvPlxuICAgICAgICAgICAgICA8bGFiZWwgaHRtbEZvcj1cIjEwMGtcIiBjbGFzc05hbWU9XCJidG4tdG9nZ2xlXCIgPisxMDBrPC9sYWJlbD5cblxuICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cImJ1ZGdldFwiIHZhbHVlPVwibm90c3VyZVwiIGlkPVwibm90c3VyZVwiIGNoZWNrZWRMaW5rPXt0aGlzLmxpbmtTdGF0ZSgnbm90c3VyZScpfSAvPlxuICAgICAgICAgICAgICA8bGFiZWwgaHRtbEZvcj1cIm5vdHN1cmVcIiAgY2xhc3NOYW1lPVwiYnRuLXRvZ2dsZVwiPk5vdCBzdXJlPC9sYWJlbD5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJidG4tcHJpbWFyeSBjYXBzXCIgZGlzYWJsZWQ9e3RoaXMuc3RhdGUuc3VibWl0dGluZ30gdHlwZT1cInN1Ym1pdFwiPlNlbmQgTWVzc2FnZTwvYnV0dG9uPlxuICAgICAgICA8L2ZpZWxkc2V0PlxuICAgICAgICA8UGVyY29sYXRlLkNvbnRhY3QuRm9vdGVyIC8+XG4gICAgICA8L2Zvcm0+XG4gICAgKVxuICB9XG59KTtcblxuUGVyY29sYXRlLkNvbnRhY3QuRm9ybUVtYWlsID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtb2RlbCA9IHRoaXMucHJvcHMubW9kZWw7XG5cbiAgICB2YXIgc2VydmljZXNOb2RlcyA9IG1vZGVsLnNlcnZpY2VzLm1hcChmdW5jdGlvbihzZXJ2aWNlLCBpbmRleCkge1xuICAgICAgcmV0dXJuICggPGxpIGtleT17aW5kZXh9PntzZXJ2aWNlfTwvbGk+ICk7XG4gICAgfSk7XG5cbiAgICB2YXIgdGltaW5nID0gbW9kZWwudGltaW5nLmpvaW4oKTtcbiAgICB2YXIgYnVkZ2V0ID0gbW9kZWwuYnVkZ2V0LmpvaW4oKTtcblxuICAgIHZhciBidWRnZXROb2RlcyA9IGJ1ZGdldCA/IFs8ZHQga2V5PScwJz5CdWRnZXQ8L2R0PiwgPGRkIGtleT0nMSc+e2J1ZGdldH08L2RkPl0gOiBudWxsO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkbD5cbiAgICAgICAgPGR0Pk5hbWU8L2R0PjxkZD57bW9kZWwubmFtZX08L2RkPlxuICAgICAgICA8ZHQ+RW1haWw8L2R0PjxkZD57bW9kZWwuZW1haWx9PC9kZD5cbiAgICAgICAgPGR0PkFib3V0PC9kdD48ZGQ+e21vZGVsLmFib3V0fTwvZGQ+XG4gICAgICAgIDxkdD5TZXJ2aWNlczwvZHQ+PGRkPjx1bD57c2VydmljZXNOb2Rlc308L3VsPjwvZGQ+XG4gICAgICAgIDxkdD5UaW1pbmc8L2R0PjxkZD57dGltaW5nfTwvZGQ+XG4gICAgICAgIHtidWRnZXROb2Rlc31cbiAgICAgICAgPGR0PlJlZmVyZXI8L2R0PjxkZD5CbG9nPC9kZD5cbiAgICAgIDwvZGw+XG4gICAgKVxuICB9XG59KTtcbiJdfQ==